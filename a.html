<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecosistema VNHE - Live App</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, collection, addDoc, query, orderBy, limit, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // --- Configuración Firebase & Lógica ---
        const firebaseConfig = JSON.parse(new URLSearchParams(window.location.search).get('firebaseConfig') || '{}') || {};
        // Nota: En este entorno, las variables globales se inyectan automáticamente. 
        // Usaremos las variables del entorno sandbox para conectar.
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #F8FAFC; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .soft-3d-icon {
            box-shadow: inset 2px 2px 5px rgba(255, 255, 255, 0.7), inset -2px -2px 5px rgba(0, 0, 0, 0.05), 5px 5px 10px rgba(0, 0, 0, 0.05);
        }
        /* Modal Transitions */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 200ms, transform 200ms; }
    </style>
</head>
<body class="text-slate-800 overflow-x-hidden min-h-screen relative">

    <!-- TOAST NOTIFICATION CONTAINER -->
    <div id="toast-container" class="fixed top-4 right-4 z-[70] flex flex-col gap-2 pointer-events-none"></div>

    <!-- LOADER -->
    <div id="loader" class="fixed inset-0 bg-slate-50 z-[60] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-16 h-16 border-4 border-amber-200 border-t-amber-500 rounded-full animate-spin mb-4"></div>
        <p class="text-slate-400 font-medium tracking-widest text-sm animate-pulse">CONECTANDO A FIREBASE...</p>
    </div>

    <!-- MODAL GENÉRICO -->
    <div id="app-modal" class="fixed inset-0 z-[80] hidden items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 relative shadow-2xl transform transition-all scale-100 opacity-100">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-rose-500">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <div id="modal-content">
                <!-- Contenido dinámico aquí -->
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-40 border-b border-slate-100 px-4 py-3 flex items-center justify-between shadow-sm">
        <div class="flex items-center gap-3">
            <button onclick="toggleSidebar()" class="p-2 rounded-xl bg-slate-100 text-slate-600 hover:bg-slate-200 active:scale-95 transition-all">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-gradient-to-br from-amber-400 to-yellow-200 rounded-full flex items-center justify-center text-white font-bold shadow-sm text-sm">VN</div>
                <h1 class="text-sm font-bold text-slate-700 tracking-wide">ECOSISTEMA <span class="text-amber-500">VNHE</span></h1>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <div class="text-[10px] bg-emerald-100 text-emerald-600 px-2 py-0.5 rounded-full font-bold flex items-center gap-1">
                <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div> ONLINE
            </div>
            <button class="p-2 text-slate-400 hover:text-amber-500 transition-colors">
                <i data-lucide="bell" class="w-5 h-5"></i>
            </button>
        </div>
    </header>

    <!-- SIDEBAR -->
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-50 opacity-0 pointer-events-none transition-opacity duration-300"></div>
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-80 bg-white shadow-2xl z-50 transition-transform duration-300 -translate-x-full flex flex-col">
        <div class="p-5 flex justify-between items-center border-b border-slate-100">
            <h2 class="font-bold text-lg text-slate-800">Menú Principal</h2>
            <button onclick="toggleSidebar()" class="p-2 hover:bg-rose-50 text-rose-400 rounded-full transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <div class="p-4 space-y-1 overflow-y-auto flex-1 scrollbar-hide">
            <div class="flex items-center gap-4 p-3 rounded-xl bg-amber-50 text-amber-600 font-semibold cursor-pointer"><i data-lucide="home" class="w-5 h-5"></i><span class="text-sm">Inicio</span></div>
            <!-- Menu Items... (Simplificados para brevedad, funcionan igual) -->
            <button onclick="showToast('Función de reporte simulada', 'info')" class="w-full flex items-center gap-4 p-3 rounded-xl text-slate-600 hover:bg-slate-50"><i data-lucide="alert-circle" class="w-5 h-5"></i><span class="text-sm font-medium">Reportar Fallo</span></button>
            <button onclick="showToast('Historial cargado en pantalla principal', 'success')" class="w-full flex items-center gap-4 p-3 rounded-xl text-slate-600 hover:bg-slate-50"><i data-lucide="trending-up" class="w-5 h-5"></i><span class="text-sm font-medium">Movimientos</span></button>
        </div>
        <div class="p-4 border-t border-slate-100 text-center">
            <p class="text-xs text-slate-400">ID Usuario: <span id="user-id-display" class="font-mono">...</span></p>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="px-4 py-6 space-y-8 max-w-md mx-auto md:max-w-3xl mb-24">
        
        <!-- BALANCES -->
        <section class="flex justify-between items-center gap-3 overflow-x-auto pb-2 scrollbar-hide">
            <div class="flex-1 min-w-[100px] bg-slate-800 text-white rounded-3xl py-4 px-4 flex flex-col items-center justify-center shadow-lg shadow-slate-200">
                <span class="text-[10px] uppercase tracking-wider opacity-70 mb-1">Saldo</span>
                <span id="balance-display" class="font-bold text-lg text-emerald-400 transition-all duration-300">...</span>
            </div>
            <div class="flex-1 min-w-[100px] bg-slate-200/50 text-slate-700 rounded-3xl py-4 px-4 flex flex-col items-center justify-center border border-slate-200">
                <span class="text-[10px] uppercase tracking-wider opacity-70 mb-1">Ganancia</span>
                <span id="profit-display" class="font-bold text-lg transition-all duration-300">...</span>
            </div>
            <button onclick="openChargeModal()" class="flex-1 min-w-[100px] bg-amber-400 text-slate-900 rounded-3xl py-4 px-4 flex flex-col items-center justify-center shadow-lg shadow-amber-200 hover:bg-amber-300 active:scale-95 transition-transform">
                <i data-lucide="plus-circle" class="w-5 h-5 mb-1"></i>
                <span class="font-bold text-xs">Cargar</span>
            </button>
        </section>

        <!-- BANNER -->
        <section class="relative w-full h-40 rounded-3xl overflow-hidden shadow-md group cursor-pointer" onclick="openProductModal('Streaming Premium', 25000)">
            <div class="absolute inset-0 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 flex items-center px-6">
                <div class="z-10 w-3/4">
                    <span class="bg-amber-400 text-slate-900 px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider mb-2 inline-block">Oferta</span>
                    <h3 class="text-white font-bold text-lg leading-tight mb-1">Plex + Emby</h3>
                    <p class="text-slate-300 text-xs mb-3">Acceso total por solo $25.000</p>
                    <div class="flex gap-2">
                        <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i data-lucide="play" class="w-3 h-3 text-white fill-white"></i></div>
                    </div>
                </div>
                <div class="absolute right-0 bottom-0 w-32 h-32 bg-amber-400 rounded-full blur-3xl opacity-20 translate-y-1/2 translate-x-1/4"></div>
            </div>
        </section>

        <!-- SERVICES GRID -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-slate-800 text-lg border-b-2 border-amber-400 inline-block pb-1">Multiproducto</h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Botones funcionales que abren modal de compra -->
                <div onclick="openProductModal('Marketplace', 5000)" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all hover:shadow-md group">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-100 to-orange-100 flex items-center justify-center mb-3 soft-3d-icon group-hover:scale-110 transition-transform"><i data-lucide="shopping-bag" class="w-7 h-7 text-orange-600"></i></div>
                    <span class="font-medium text-slate-600 text-sm text-center">Marketplace</span>
                </div>
                <div onclick="openProductModal('Lotería', 3000)" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all hover:shadow-md group">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-100 to-teal-100 flex items-center justify-center mb-3 soft-3d-icon group-hover:scale-110 transition-transform"><i data-lucide="dices" class="w-7 h-7 text-emerald-600"></i></div>
                    <span class="font-medium text-slate-600 text-sm text-center">Loterías</span>
                </div>
                <div onclick="openProductModal('Recargas', 10000)" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all hover:shadow-md group">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-100 to-cyan-100 flex items-center justify-center mb-3 soft-3d-icon group-hover:scale-110 transition-transform"><i data-lucide="repeat" class="w-7 h-7 text-blue-600"></i></div>
                    <span class="font-medium text-slate-600 text-sm text-center">Recargas</span>
                </div>
                <div onclick="openProductModal('Paquetes', 15000)" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all hover:shadow-md group">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-100 to-violet-100 flex items-center justify-center mb-3 soft-3d-icon group-hover:scale-110 transition-transform"><i data-lucide="package" class="w-7 h-7 text-purple-600"></i></div>
                    <span class="font-medium text-slate-600 text-sm text-center">Paquetes</span>
                </div>
                <div onclick="openProductModal('Pines', 20000)" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all hover:shadow-md group">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-pink-100 to-rose-100 flex items-center justify-center mb-3 soft-3d-icon group-hover:scale-110 transition-transform"><i data-lucide="gift" class="w-7 h-7 text-pink-600"></i></div>
                    <span class="font-medium text-slate-600 text-sm text-center">Pines</span>
                </div>
                <div onclick="openProductModal('Pin EPM', 25000)" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 flex flex-col items-center justify-center cursor-pointer active:scale-95 transition-all hover:shadow-md group">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-yellow-100 to-amber-100 flex items-center justify-center mb-3 soft-3d-icon group-hover:scale-110 transition-transform"><i data-lucide="lightbulb" class="w-7 h-7 text-yellow-600"></i></div>
                    <span class="font-medium text-slate-600 text-sm text-center">Pin Epm</span>
                </div>
            </div>
        </section>

        <!-- HISTORIAL DE MOVIMIENTOS -->
        <section>
            <h3 class="font-bold text-slate-800 text-lg mb-3 flex items-center gap-2">
                <i data-lucide="history" class="w-5 h-5 text-slate-400"></i> Últimos Movimientos
            </h3>
            <div id="transactions-list" class="space-y-3 pb-4">
                <p class="text-sm text-slate-400 text-center py-4">Cargando movimientos...</p>
            </div>
        </section>

    </main>

    <!-- FIREBASE LOGIC SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, query, orderBy, limit, serverTimestamp, setDoc, getDoc, runTransaction } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // --- 1. Inicialización ---
        const firebaseConfig = {
  apiKey: "AIzaSyBYaYm2LDE6QM_K5Dii74sfZCYYd1eQfvY",
  authDomain: "ventasstre-a24b7.firebaseapp.com",
  projectId: "ventasstre-a24b7",
  storageBucket: "ventasstre-a24b7.firebasestorage.app",
  messagingSenderId: "197117622028",
  appId: "1:197117622028:web:ae6380faf72f965a41fb29",
  measurementId: "G-GB44T0FYCT"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        let currentUser = null;

        // --- 2. Autenticación ---
        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
                document.getElementById('loader').innerHTML = `<p class="text-rose-500">Error de conexión. Recarga la página.</p>`;
            }
        }
        initAuth();

        // --- 3. Lógica de Negocio y Listeners ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-id-display').textContent = user.uid.substring(0,6) + '...';
                
                // Ocultar Loader
                const loader = document.getElementById('loader');
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);

                // Inicializar Wallet si no existe
                const walletRef = doc(db, 'artifacts', appId, 'users', user.uid, 'wallet', 'main');
                const walletSnap = await getDoc(walletRef);
                
                if (!walletSnap.exists()) {
                    await setDoc(walletRef, {
                        balance: 8063, // Saldo inicial demo
                        profit: 200,
                        lastUpdated: serverTimestamp()
                    });
                }

                // Escuchar Saldo
                onSnapshot(walletRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        updateBalanceUI(data.balance, data.profit);
                    }
                }, (error) => console.error("Error escuchando saldo:", error));

                // Escuchar Movimientos
                const transactionsRef = collection(db, 'artifacts', appId, 'users', user.uid, 'transactions');
                const q = query(transactionsRef, orderBy('timestamp', 'desc'), limit(10));
                
                onSnapshot(q, (snapshot) => {
                    const list = document.getElementById('transactions-list');
                    if (snapshot.empty) {
                        list.innerHTML = `<p class="text-xs text-slate-400 text-center py-2">No hay movimientos recientes.</p>`;
                    } else {
                        list.innerHTML = '';
                        snapshot.forEach((doc) => {
                            const t = doc.data();
                            list.innerHTML += createTransactionHTML(t);
                        });
                        lucide.createIcons();
                    }
                }, (error) => console.error("Error escuchando transacciones:", error));

            }
        });

        // --- Funciones de UI ---
        function updateBalanceUI(balance, profit) {
            // Animación de conteo simple
            document.getElementById('balance-display').textContent = `$${balance.toLocaleString()}`;
            document.getElementById('profit-display').textContent = `$${profit.toLocaleString()}`;
        }

        function createTransactionHTML(t) {
            const isPositive = t.type === 'deposit';
            const colorClass = isPositive ? 'text-emerald-600' : 'text-slate-800';
            const bgClass = isPositive ? 'bg-emerald-100' : 'bg-rose-50';
            const sign = isPositive ? '+' : '-';
            const icon = isPositive ? 'arrow-down-left' : 'shopping-bag';
            
            // Formatear fecha
            let timeStr = 'Reciente';
            if (t.timestamp) {
                const date = t.timestamp.toDate();
                timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }

            return `
                <div class="bg-white p-3 rounded-2xl border border-slate-100 flex items-center justify-between shadow-sm">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full ${bgClass} flex items-center justify-center text-${isPositive ? 'emerald' : 'rose'}-500">
                            <i data-lucide="${icon}" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-700">${t.description}</p>
                            <p class="text-[10px] text-slate-400">${timeStr} • ${t.status || 'Exitoso'}</p>
                        </div>
                    </div>
                    <span class="font-bold text-sm ${colorClass}">${sign}$${t.amount.toLocaleString()}</span>
                </div>
            `;
        }

        // --- Operaciones Globales (Expuestas al Window) ---
        
        window.processRecharge = async (amount) => {
            if (!currentUser) return;
            const btn = document.getElementById('confirm-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>`;
            btn.disabled = true;

            try {
                const walletRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'wallet', 'main');
                const transactionsRef = collection(db, 'artifacts', appId, 'users', currentUser.uid, 'transactions');

                await runTransaction(db, async (transaction) => {
                    const sfDoc = await transaction.get(walletRef);
                    if (!sfDoc.exists()) throw "Cuenta no existe";
                    
                    const newBalance = sfDoc.data().balance + Number(amount);
                    transaction.update(walletRef, { balance: newBalance });
                    
                    // No podemos añadir doc en transacción fácilmente sin ID pre-generado, 
                    // así que lo hacemos fuera o usamos set con ref. 
                    // Para simplificar Firestore simple: Update here, Add later.
                });

                // Añadir transacción (fuera del atomic lock para simplificar este ejemplo UI)
                await addDoc(transactionsRef, {
                    type: 'deposit',
                    amount: Number(amount),
                    description: 'Recarga de Saldo',
                    timestamp: serverTimestamp(),
                    status: 'Aprobado'
                });

                showToast(`¡Recarga de $${amount} exitosa!`, 'success');
                closeModal();
            } catch (e) {
                console.error(e);
                showToast('Error al recargar', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        };

        window.processPurchase = async (serviceName, price) => {
            if (!currentUser) return;
            const btn = document.getElementById('confirm-purchase-btn');
            btn.innerHTML = `<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>`;
            btn.disabled = true;

            try {
                const walletRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'wallet', 'main');
                const transactionsRef = collection(db, 'artifacts', appId, 'users', currentUser.uid, 'transactions');

                await runTransaction(db, async (transaction) => {
                    const sfDoc = await transaction.get(walletRef);
                    if (!sfDoc.exists()) throw "Error cuenta";
                    
                    const currentBal = sfDoc.data().balance;
                    if (currentBal < price) throw "Saldo insuficiente";

                    const newBalance = currentBal - Number(price);
                    const newProfit = sfDoc.data().profit + (price * 0.05); // 5% profit simulado

                    transaction.update(walletRef, { 
                        balance: newBalance,
                        profit: newProfit
                    });
                });

                await addDoc(transactionsRef, {
                    type: 'purchase',
                    amount: Number(price),
                    description: `Compra ${serviceName}`,
                    timestamp: serverTimestamp(),
                    status: 'Completado'
                });

                showToast(`¡Compra de ${serviceName} exitosa!`, 'success');
                closeModal();
            } catch (e) {
                if (e === "Saldo insuficiente") {
                    showToast('Saldo insuficiente. Recarga primero.', 'error');
                } else {
                    console.error(e);
                    showToast('Error en la transacción', 'error');
                }
            } finally {
                btn.innerHTML = "Confirmar Compra";
                btn.disabled = false;
            }
        };

    </script>

    <!-- UI INTERACTION SCRIPT -->
    <script>
        // Inicializar Iconos UI
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        // Sidebar logic
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isOpen = !sidebar.classList.contains('-translate-x-full');
            
            if (isOpen) {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.remove('opacity-100', 'pointer-events-auto');
                overlay.classList.add('opacity-0', 'pointer-events-none');
            } else {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.add('opacity-100', 'pointer-events-auto');
                overlay.classList.remove('opacity-0', 'pointer-events-none');
            }
        }

        // Toast System
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            // Colores según tipo
            const colors = {
                success: 'bg-emerald-500 text-white',
                error: 'bg-rose-500 text-white',
                info: 'bg-slate-800 text-white'
            };

            const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'alert-triangle' : 'info';

            toast.className = `${colors[type]} px-4 py-3 rounded-xl shadow-lg flex items-center gap-3 text-sm font-medium transform transition-all duration-300 translate-x-full pointer-events-auto`;
            toast.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5"></i> <span>${message}</span>`;
            
            container.appendChild(toast);
            lucide.createIcons();

            // Animate In
            requestAnimationFrame(() => toast.classList.remove('translate-x-full'));

            // Remove
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Modal Logic
        function closeModal() {
            const modal = document.getElementById('app-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function openModal(contentHTML) {
            const modal = document.getElementById('app-modal');
            const content = document.getElementById('modal-content');
            content.innerHTML = contentHTML;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            lucide.createIcons();
        }

        // Specific Modals
        function openChargeModal() {
            openModal(`
                <div class="text-center">
                    <div class="w-16 h-16 bg-amber-100 text-amber-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="wallet" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">Cargar Saldo</h3>
                    <p class="text-slate-500 text-sm mb-6">Ingresa el monto a añadir a tu billetera virtual.</p>
                    
                    <input type="number" id="charge-amount" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-lg font-bold text-center mb-4 focus:outline-none focus:border-amber-400 focus:ring-2 focus:ring-amber-200" placeholder="$0" value="10000">
                    
                    <button id="confirm-btn" onclick="processRecharge(document.getElementById('charge-amount').value)" class="w-full bg-amber-400 text-slate-900 font-bold py-3 rounded-xl shadow-lg shadow-amber-200 hover:bg-amber-300 active:scale-95 transition-all">
                        Confirmar Recarga
                    </button>
                </div>
            `);
        }

        function openProductModal(name, price) {
            openModal(`
                <div class="text-center">
                    <div class="w-16 h-16 bg-blue-100 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="shopping-cart" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-1">Comprar ${name}</h3>
                    <p class="text-slate-400 text-sm mb-6">Valor: <span class="text-slate-800 font-bold">$${price.toLocaleString()}</span></p>
                    
                    <div class="bg-slate-50 p-4 rounded-xl mb-6 text-left">
                        <p class="text-xs text-slate-400 uppercase tracking-wider mb-2">Detalles</p>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-slate-600">Servicio:</span>
                            <span class="font-medium">${name}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-600">Comisión:</span>
                            <span class="font-medium text-emerald-500">+$${(price * 0.05).toLocaleString()}</span>
                        </div>
                    </div>

                    <button id="confirm-purchase-btn" onclick="processPurchase('${name}', ${price})" class="w-full bg-slate-800 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-slate-700 active:scale-95 transition-all">
                        Confirmar Compra
                    </button>
                </div>
            `);
        }
    </script>
</body>
</html>


